name: PHPUnit Tests

on:
    pull_request:
        branches:
            - development

jobs:
    test:
        runs-on: ubuntu-latest
        services:
            mysql:
                image: mysql:8.4
                env:
                    MYSQL_ROOT_PASSWORD: ''
                    MYSQL_DATABASE: root
                ports:
                    - '3306:3306'

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Install dependencies
              run: composer install

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: 7.4

            - name: Create Test Environement
              run: bin/install-wp-tests.sh wordpress_test root '' localhost latest      

            - name: Run PHPUnit tests
              run: vendor/bin/phpunit --configuration phpunit.xml.dist

            - name: Check test results
              if: failure()
              run: exit 1
